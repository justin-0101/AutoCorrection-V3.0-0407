from typing import List


class BaseTask:
    def __init__(self, prompt: str, input_variables: List[str], format_instruction: str) -> None:
        self.__prompt: str = prompt
        self.__format_instruction: str = format_instruction
        self.__input_variables: List[str] = input_variables

    def prompt(self) -> str:
        return self.__prompt

    def format_instruction(self) -> str:
        return self.__format_instruction

    def input_variables(self) -> List[str]:
        return self.__input_variables


task_spell_error = BaseTask(
    prompt="""
你是一个中考语文阅卷老师，现在有一篇待批改作文，需要你对这篇待批改作文进行错别字检测，统计出所有的错别字并按规则计算出错别字扣分项。
以下是完成这一任务的步骤：
Step1:找出文章中所有的错别字并统计个数
Step2:根据以下规则计算出扣分项：
1）出现错别字，1个错别字扣1分；
2）重复出现的错别字不重复扣分；
3）扣分上限为5分，扣分超过5分则不再扣错别字分
输出格式：{format_instructions}
待批改作文：{article}""",
    input_variables=["article"],
    format_instruction="""
统计出所有错别字并计算出扣分项后，对其进行如下Json格式的输出：
{"错别字扣分":"具体扣分数（例如：2）","解析":"具体扣分原因描述（例如："发现2个错别字，分别是'澡'应为'藻'，'彻'应为'澈'，每个错别字扣1分，共扣2分。")"}
"""
)

task_content_analysis = BaseTask(
    prompt="""
你是一个中考语文阅卷老师，现在有一个作文题目和一篇待批改作文，需要你对这篇待批改作文进行内容主旨的分析，并给出内容主旨层面的最终评分。
具体评分规则如下：
1）符合题意、中心突出、内容充实、思想健康、感情真挚为一等，可按16-20分酌情给分；
2）符合题意、主题明确、内容较充实、思想健康、感情真实为二等，可按11-15分酌情给分3）基本符合题意、中心基本明确、内容单薄、思想基本健康、感情基本真实为三等，可按6-10分酌情给分；		4）偏离题意、中心不明确、内容不当、思想不健康、感情虚假为四等，可按0-5分酌情给分。
在分析过程中应特别注意一下几个方面的解析：
1）题目期望的主旨是什么，文章作者表达的主旨是什么，从哪里得以体现，这二者是否契合？
2）文章论点是否清晰，是否契合主题，找出文章的中心论点与分论点加以分析；
3）文章内容是否充实，论据是否翔实，是否举出具体的事例加以分析（若有请找出并加以分析），是否有假大空说空话之嫌？
4）文章思想是否积极健康，是否有政治层面的不健康思想，若有则判为四等；
5）分析文章情感，找出情感流露的句段进行分析
输出格式：{format_instructions}
作文题目：{subject}
待批改作文：{article}""",
    input_variables=["subject", "article"],
    format_instruction="""分析与评分结束后请以如下Json格式进行输出：
{"内容主旨得分": "xx",解析:{"主旨解析": "xxxxxxxx","论点解析": "xxxxxxxx","论据解析": "xxxxxxxx","思想情感解析": "xxxxxxxx"}}"""
)

task_express_analysis = BaseTask(
    prompt="""
你是一个中考语文阅卷老师，现在有一个作文题目和一篇待批改作文，需要你对这篇待批改作文进行表达文采的详细分析，并给出表达文采层面的最终评分。

作为资深阅卷老师，你需要提供非常详细的分析，识别出作文中所有的写作技巧和亮点，并对每一个技巧进行具体分析。

具体评分规则如下：
1）深刻、丰富、有文采、有创意为一等，可按16-20分酌情给分；
2）较深刻、较丰富、较有文采、较有创意为二等，可按11-15分酌情给分；
3）略显深刻、略显丰富、略显文采、略显创意为三等，可按6-10分酌情给分；		
4）个别语句有深意、个别例子较好、个别语句较精彩、个别地方有深意为四等，可按0-5分酌情给分。

在分析过程中，你必须详细分析以下几个方面，并举出原文中的具体例子：

1）论证手法分析：是否有2个以上论证手法

2）引经据典解析：是否有2处地方引经据典
3）修辞手法解析： 检查是否运用了2种以上修辞手法

4）语言特色分析（新增）：
   - 语言的准确性：分析用词是否精准，是否有不当用词
   - 语言的生动性：分析语言是否生动形象，是否有特色
   - 语言的简洁性：分析语言是否简洁明了，是否有赘述
   - 语言的多样性：分析句式是否多样，长短句搭配是否合理
   - 语言的节奏感：分析文章语言的节奏感和韵律美

5）创新表达分析（新增）：
   - 独特视角：分析文章是否有独特的视角和观点
   - 表达方式创新：分析文章是否有创新的表达方式
   - 结构创新：分析文章结构是否有创新之处
   - 语言创新：分析文章是否有创新的语言表达

请务必做到详细具体，并进行深入分析。避免泛泛而谈或简单概括。

输出格式：{format_instructions}
作文题目：{subject}
待批改作文：{article}""",
    input_variables=["subject", "article"],
    format_instruction="""分析与评分结束后请以如下Json格式进行详细输出：
{"表达文采得分": "xx","解析":{
  "论证手法解析": "详细分析至少3种不同论证手法，每种手法必须引用原文具体例子并分析",
  "引经据典解析": "详细分析文中所有引经据典之处，必须引用原文具体例子并分析",
  "修辞手法解析": "详细分析至少5种不同修辞手法，每种手法必须引用原文具体例子并分析",
  "语言特色分析": "详细分析文章语言的准确性、生动性、简洁性、多样性和节奏感",
  "创新表达分析": "详细分析文章在视角、表达方式、结构和语言上的创新之处"
}}
    """
)

task_summary = BaseTask(
    prompt="""
    你是一个中考语文阅卷老师,现在有一篇待批改作文，其错别字检测，内容主旨分析，表达文采分析等方面的工作均已完成，现在需要你对这些工作解析做一个总结。
    解析细节：{detail}""",
    input_variables=["detail"],
    format_instruction=None
)

# 新增统一评分任务
task_unified_scoring = BaseTask(
    prompt="""{unified_prompt}""",  # 占位符，由 ai_correction_config 动态填充
    input_variables=["subject", "article", "text_length"],
    format_instruction="""
    必须返回严格遵循以下结构的JSON：
    {
      "总得分": "45",
      "等级评定": "A-优秀",
      "分项得分": {
        "内容主旨": "18",
        "语言文采": "14",
        "文章结构": "9",
        "文面书写": "4"
      },
      "错别字": [
        {"位置": "第二段第3行", "错误": "错字", "正确写法": "正字", "上下文": "包含错别字的上下文"}
      ],
      "多维分析": {
        "内容分析": "分析文本（200字）",
        "表达分析": "分析文本（200字）",
        "结构分析": "分析文本（150字）",
        "书写分析": "分析文本（50字）"
      },
      "总体评价": "对作文的整体评价和建议（200字）"
    }"""
)
