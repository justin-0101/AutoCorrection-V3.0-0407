# 作文批改系统架构总览

## 1. 系统概述

作文批改系统（AutoCorrection V2.0）是一个基于人工智能的作文批改平台，提供智能评分、详细点评和建议改进的在线服务。本文档对系统整体架构进行汇总描述，帮助开发人员理解系统设计与各模块关系。

## 2. 系统架构图

```
┌─────────────────┐     ┌─────────────────┐
│  前端界面       │◄────┤  用户浏览器     │
└───────┬─────────┘     └─────────────────┘
        │
        ▼
┌─────────────────┐     ┌─────────────────┐
│  Flask Web应用  │─────┤  会员系统       │
└───────┬─────────┘     └─────────────────┘
        │
        ├─────────────────────────────────┐
        │                                 │
        ▼                                 ▼
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│  作文批改系统   │────►│  异步任务队列   │────►│  AI批改服务     │
└───────┬─────────┘     └─────────────────┘     └─────────────────┘
        │                        │
        │                        │
        ▼                        ▼
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│  数据库系统     │◄────┤  WebSocket服务  │────►│  客户端通知     │
└───────┬─────────┘     └─────────────────┘     └─────────────────┘
        │
        ▼
┌─────────────────┐     ┌─────────────────┐
│  数据分析系统   │────►│  后台管理系统   │
└─────────────────┘     └─────────────────┘
        │                        │
        ▼                        ▼
┌─────────────────┐     ┌─────────────────┐
│  监控与备份     │     │  系统日志       │
└─────────────────┘     └─────────────────┘
```

## 3. 核心模块概述

### 3.1 前端界面

- **功能**：提供用户交互界面，包括作文提交、结果显示、用户中心等
- **技术**：HTML, CSS, JavaScript, Bootstrap, Vue.js
- **关键文件**：templates/、static/
- **详细设计**：参见各页面设计文档

### 3.2 Flask Web应用

- **功能**：提供Web服务，处理HTTP请求，协调各模块工作
- **技术**：Python, Flask
- **关键文件**：app.py, config/, api/
- **设计文档**：[system_architecture.md](./system_architecture.md)

### 3.3 会员系统

- **功能**：管理用户订阅、支付、权限控制
- **技术**：Python, SQLAlchemy, 支付接口
- **关键文件**：api/membership_api.py, core/subscription.py
- **设计文档**：[membership_system.md](./membership_system.md)

### 3.4 作文批改系统

- **功能**：处理作文提交、生成批改结果
- **技术**：Python, NLP算法
- **关键文件**：api/correction_api.py, core/correction.py
- **设计文档**：[correction_system.md](./correction_system.md)

### 3.5 异步任务系统

- **功能**：处理耗时操作，如作文批改、邮件发送等
- **技术**：Python, Celery, Redis
- **关键文件**：tasks/, celery_app.py
- **设计文档**：[async_task_system.md](./async_task_system.md)

### 3.6 AI批改服务

- **功能**：使用人工智能模型评估作文，生成批改结果
- **技术**：NLP模型, API集成
- **关键文件**：services/ai_service.py
- **设计文档**：AI模型集成文档

### 3.7 数据库系统

- **功能**：存储用户数据、作文记录、批改结果等
- **技术**：SQLite/MySQL, SQLAlchemy
- **关键文件**：database/db_manager.py, database/models/
- **设计文档**：数据库设计文档

### 3.8 WebSocket服务

- **功能**：提供实时通知功能
- **技术**：Flask-SocketIO, Redis
- **关键文件**：websocket/socket_server.py
- **设计文档**：[websocket_notification_system.md](./websocket_notification_system.md)

### 3.9 数据分析系统

- **功能**：分析作文数据，生成统计报告和学习建议
- **技术**：Python, Pandas, 数据可视化
- **关键文件**：api/analysis_api.py, core/analytics.py
- **设计文档**：[data_analysis_system.md](./data_analysis_system.md)

### 3.10 后台管理系统

- **功能**：管理用户、作文、系统配置等
- **技术**：Python, Flask, Bootstrap
- **关键文件**：api/admin_api.py, templates/admin/
- **设计文档**：[admin_system.md](./admin_system.md)

### 3.11 监控与备份系统

- **功能**：监控系统性能，备份重要数据
- **技术**：Python, 系统工具
- **关键文件**：utils/monitoring.py, tasks/backup_tasks.py
- **设计文档**：[system_monitoring.md](./system_monitoring.md)

## 4. 数据流向

### 4.1 作文批改流程

```
用户提交作文 → Web应用接收 → 创建批改任务 → 异步任务队列 → 
AI批改服务处理 → 保存结果到数据库 → WebSocket推送通知 → 
用户查看结果 → 数据分析系统处理
```

### 4.2 用户注册/登录流程

```
用户注册/登录 → Web应用验证 → 生成JWT令牌 → 
返回令牌给客户端 → 用户身份验证通过 → 
访问受保护资源
```

### 4.3 会员订阅流程

```
用户选择套餐 → 创建订单 → 跳转支付页面 → 
完成支付 → 异步处理支付结果 → 更新会员状态 → 
WebSocket通知用户 → 会员权限激活
```

## 5. 技术栈

### 5.1 后端技术

- **编程语言**：Python 3.8+
- **Web框架**：Flask
- **ORM**：SQLAlchemy
- **数据库**：SQLite(开发) / MySQL(生产)
- **缓存**：Redis
- **异步任务**：Celery
- **消息队列**：Redis
- **WebSocket**：Flask-SocketIO
- **认证**：JWT

### 5.2 前端技术

- **HTML/CSS/JavaScript**
- **前端框架**：Bootstrap, Vue.js
- **HTTP客户端**：Axios
- **WebSocket客户端**：Socket.IO Client

### 5.3 部署技术

- **Web服务器**：Nginx
- **应用服务器**：Gunicorn
- **容器化**：Docker, Docker Compose
- **进程管理**：Supervisor
- **SSL证书**：Let's Encrypt

## 6. 安全设计

- **认证**：基于JWT的用户认证
- **授权**：基于角色的访问控制(RBAC)
- **数据保护**：敏感数据加密存储
- **通信安全**：HTTPS加密传输
- **输入验证**：全面的输入验证和过滤
- **CSRF防护**：使用CSRF令牌
- **日志审计**：用户操作和系统事件日志

## 7. 扩展性设计

- **模块化架构**：松耦合的模块设计
- **服务分离**：核心功能独立服务化
- **异步处理**：使用消息队列分担负载
- **水平扩展**：支持多实例部署
- **可配置性**：通过配置文件调整系统行为
- **插件机制**：支持功能扩展

## 8. 环境配置

### 8.1 开发环境

- **操作系统**：Windows/Linux/MacOS
- **依赖管理**：requirements.txt
- **环境变量**：.env文件
- **开发工具**：任意Python IDE

### 8.2 测试环境

- **操作系统**：Linux (推荐Ubuntu/CentOS)
- **部署方式**：Docker Compose
- **监控**：基本监控功能

### 8.3 生产环境

- **操作系统**：Linux (推荐CentOS Stream 9)
- **部署方式**：Nginx + Gunicorn + Supervisor
- **监控**：完整监控和报警系统
- **备份**：自动数据备份

## 9. 系统限制

- **并发处理**：单实例约支持50-100并发用户
- **数据量**：单数据库适合10万用户和100万作文记录
- **批改速度**：视AI服务响应时间，通常10-30秒/篇
- **文件大小**：上传文件限制为10MB

## 10. 未来扩展

- **多语言支持**：增加多种语言界面
- **移动应用**：开发配套移动应用
- **教师工具**：添加教师批改辅助功能
- **AI模型升级**：集成更先进的批改模型
- **API开放**：提供对外API服务 